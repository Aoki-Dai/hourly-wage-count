<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#2196F3">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="description" content="時給に基づいて秒単位の収入を計算し、リアルタイムで可視化するWebアプリケーション">
    <title>時給カウンター</title>
    <link rel="stylesheet" href="styles/main.css">
</head>
<body>
    <a href="#main-content" class="skip-link">メインコンテンツへスキップ</a>
    <div class="container">
        <header>
            <h1>時給カウンター</h1>
        </header>
        
        <main id="main-content">
            <section class="wage-input-section" aria-labelledby="wage-input-heading">
                <h2 id="wage-input-heading" class="visually-hidden">時給入力</h2>
                <label for="hourly-wage">時給（円）:</label>
                <input type="number" 
                       id="hourly-wage" 
                       placeholder="1000" 
                       min="0" 
                       max="1000000" 
                       step="0.01"
                       aria-describedby="wage-error"
                       autocomplete="off">
                <div id="wage-error" class="error-message" aria-live="assertive" role="alert"></div>
            </section>
            
            <section class="display-section" aria-labelledby="display-heading">
                <h2 id="display-heading" class="visually-hidden">表示セクション</h2>
                <div class="earnings-display">
                    <h2 id="earnings-heading">累積収入</h2>
                    <div id="current-earnings" 
                         class="earnings-amount" 
                         aria-labelledby="earnings-heading"
                         tabindex="0">¥0</div>
                </div>
                
                <div class="time-display">
                    <h2 id="time-heading">経過時間</h2>
                    <div id="elapsed-time" 
                         class="time-amount" 
                         aria-labelledby="time-heading"
                         tabindex="0">00:00:00</div>
                </div>
            </section>
            
            <section class="controls-section" aria-labelledby="controls-heading">
                <h2 id="controls-heading" class="visually-hidden">操作コントロール</h2>
                <button id="start-stop-btn" 
                        class="control-btn primary"
                        aria-label="開始">開始</button>
                <button id="reset-btn" 
                        class="control-btn secondary"
                        aria-label="リセット">リセット</button>
                <div id="reset-disabled-description" class="visually-hidden">
                    カウンターが動作中はリセットできません。まず停止してください。
                </div>
            </section>
            
            <section class="visualization-section" aria-labelledby="visualization-heading">
                <h2 id="visualization-heading">収入進捗</h2>
                <div class="visualization-tabs" role="tablist" aria-label="視覚化オプション">
                    <button id="bar-view-btn" 
                            class="viz-tab-btn active" 
                            role="tab" 
                            aria-selected="true" 
                            aria-controls="progress-container">バー表示</button>
                    <button id="circle-view-btn" 
                            class="viz-tab-btn" 
                            role="tab" 
                            aria-selected="false" 
                            aria-controls="circle-chart-container">円グラフ表示</button>
                </div>
                <div id="progress-container" 
                     class="progress-container" 
                     role="tabpanel" 
                     aria-labelledby="bar-view-btn">
                    <div id="progress-bar" 
                         class="progress-bar" 
                         role="progressbar" 
                         aria-valuenow="0" 
                         aria-valuemin="0" 
                         aria-valuemax="100"></div>
                </div>
                <div id="circle-chart-container" 
                     class="circle-chart-container" 
                     style="display: none;" 
                     role="tabpanel" 
                     aria-labelledby="circle-view-btn">
                    <div class="circle-chart">
                        <svg id="circle-chart-svg" viewBox="0 0 100 100" role="img" aria-labelledby="circle-title circle-desc">
                            <title id="circle-title">収入進捗円グラフ</title>
                            <desc id="circle-desc">現在の収入進捗を円グラフで表示</desc>
                            <circle class="circle-bg" cx="50" cy="50" r="45"></circle>
                            <circle id="circle-progress" class="circle-progress" cx="50" cy="50" r="45" stroke-dasharray="0 283"></circle>
                            <text id="circle-text" class="circle-text" x="50" y="50" aria-hidden="true">0%</text>
                        </svg>
                    </div>
                </div>
                <div id="progress-label" 
                     class="progress-label" 
                     aria-live="polite">0%</div>
            </section>
        </main>
        
        <footer class="accessibility-info">
            <details>
                <summary>キーボードショートカット</summary>
                <div class="keyboard-shortcuts">
                    <ul>
                        <li><kbd>Tab</kbd> - フォーカスを次の要素に移動</li>
                        <li><kbd>Shift</kbd> + <kbd>Tab</kbd> - フォーカスを前の要素に移動</li>
                        <li><kbd>Enter</kbd> または <kbd>Space</kbd> - フォーカスされたボタンを押す</li>
                        <li><kbd>Esc</kbd> - カウンターをリセット（確認あり）</li>
                        <li><kbd>←</kbd> <kbd>→</kbd> - 視覚化タブ間を移動</li>
                    </ul>
                </div>
            </details>
        </footer>
    </div>
    
    <script src="js/storage-manager.js"></script>
    <script src="js/visualizer.js"></script>
    <script src="js/ui-controller.js"></script>
    <script src="js/performance-optimizer.js"></script>
    <script src="js/main.js"></script>
    <script src="js/test-validation.js"></script>
    <script src="js/test-wage-counter.js"></script>
    <script src="js/test-storage-manager.js"></script>
    <script src="js/test-end-to-end.js"></script>
    <script src="js/test-performance-optimizer.js"></script>
    <script src="js/app-verification.js"></script>
    
    <!-- 開発モード用のテストボタン -->
    <div id="test-controls" style="display: none; position: fixed; bottom: 10px; right: 10px; background: #fff; padding: 10px; border-radius: 5px; box-shadow: 0 2px 5px rgba(0,0,0,0.2); z-index: 1000;">
        <h3 style="margin-top: 0; margin-bottom: 10px; font-size: 0.9rem; text-align: center;">テストパネル</h3>
        <button id="run-validation-tests" class="control-btn secondary" style="font-size: 0.8rem; padding: 0.5rem; width: 100%; margin-bottom: 5px;">バリデーションテスト実行</button>
        <button id="run-wage-counter-tests" class="control-btn secondary" style="font-size: 0.8rem; padding: 0.5rem; width: 100%; margin-bottom: 5px;">WageCounterテスト実行</button>
        <button id="run-storage-manager-tests" class="control-btn secondary" style="font-size: 0.8rem; padding: 0.5rem; width: 100%; margin-bottom: 5px;">StorageManagerテスト実行</button>
        <button id="run-performance-tests" class="control-btn secondary" style="font-size: 0.8rem; padding: 0.5rem; width: 100%;">パフォーマンス最適化テスト実行</button>
        <div id="test-results" style="margin-top: 10px; font-size: 0.8rem; color: #333; max-height: 100px; overflow-y: auto;"></div>
    </div>
    
    <script>
        // 開発モードの場合にテストコントロールを表示
        if (window.location.search.includes('test=true')) {
            document.getElementById('test-controls').style.display = 'block';
            
            // テスト結果表示用の関数
            function showTestResult(message, isSuccess = true) {
                const resultsDiv = document.getElementById('test-results');
                const resultElement = document.createElement('div');
                resultElement.style.color = isSuccess ? '#4CAF50' : '#f44336';
                resultElement.style.marginBottom = '5px';
                resultElement.textContent = message;
                resultsDiv.prepend(resultElement);
                
                // 古い結果を削除（最大5件まで表示）
                while (resultsDiv.children.length > 5) {
                    resultsDiv.removeChild(resultsDiv.lastChild);
                }
            }
            
            // バリデーションテスト
            document.getElementById('run-validation-tests').addEventListener('click', function() {
                try {
                    runValidationTests();
                    showTestResult('✅ バリデーションテスト完了');
                } catch (e) {
                    showTestResult('❌ バリデーションテストエラー: ' + e.message, false);
                }
            });
            
            // WageCounterテスト
            document.getElementById('run-wage-counter-tests').addEventListener('click', function() {
                try {
                    runWageCounterTests();
                    showTestResult('✅ WageCounterテスト完了');
                } catch (e) {
                    showTestResult('❌ WageCounterテストエラー: ' + e.message, false);
                }
            });
            
            // StorageManagerテスト
            document.getElementById('run-storage-manager-tests').addEventListener('click', function() {
                try {
                    runStorageManagerTests();
                    showTestResult('✅ StorageManagerテスト完了');
                } catch (e) {
                    showTestResult('❌ StorageManagerテストエラー: ' + e.message, false);
                }
            });
            
            // パフォーマンス最適化テスト
            document.getElementById('run-performance-tests').addEventListener('click', function() {
                try {
                    runPerformanceOptimizerTests();
                    showTestResult('✅ パフォーマンス最適化テスト完了');
                } catch (e) {
                    showTestResult('❌ パフォーマンス最適化テストエラー: ' + e.message, false);
                }
            });
        }
    </script>
</body>
</html>